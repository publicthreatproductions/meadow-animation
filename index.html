<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body, html { 
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #2d5a27;
        }
    </style>
</head>
<body>
    <canvas id="meadow"></canvas>
    <script>
        // Wait for DOM to be fully loaded
        window.addEventListener('load', () => {
            const canvas = document.getElementById('meadow');
            const ctx = canvas.getContext('2d');
            
            // Base colors with variations
            const flowerPalettes = [
                ['#ff6b6b', '#ff8585', '#ff4d4d'],
                ['#ff4d4d', '#ff3333', '#ff6666'],
                ['#ffd700', '#ffed4a', '#ffc800'],
                ['#ff69b4', '#ff8dc8', '#ff45a0'],
                ['#dda0dd', '#eec6ee', '#cc7acc'],
                ['#87ceeb', '#b0e2ff', '#6ca6cd']
            ];

            let grass = [];
            const spacing = 6;

            function initializeGrass() {
                grass = [];
                for (let y = canvas.height; y > 0; y -= spacing) {
                    for (let x = 0; x < canvas.width; x += spacing) {
                        grass.push(new Grass(x, y));
                    }
                }
                console.log('Grass initialized:', grass.length, 'blades');
            }

            function setSize() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                console.log('Canvas resized:', canvas.width, 'x', canvas.height);
                initializeGrass();
            }

            function lerpColor(color1, color2, factor) {
                const r1 = parseInt(color1.substr(1,2), 16);
                const g1 = parseInt(color1.substr(3,2), 16);
                const b1 = parseInt(color1.substr(5,2), 16);
                const r2 = parseInt(color2.substr(1,2), 16);
                const g2 = parseInt(color2.substr(3,2), 16);
                const b2 = parseInt(color2.substr(5,2), 16);
                
                const r = Math.round(r1 + (r2 - r1) * factor);
                const g = Math.round(g1 + (g2 - g1) * factor);
                const b = Math.round(b1 + (b2 - b1) * factor);
                
                return `rgb(${r},${g},${b})`;
            }

            class Grass {
                constructor(x, y) {
                    this.x = x;
                    this.y = y;
                    this.isFlower = Math.random() < 0.2;
                    if (this.isFlower) {
                        const palette = flowerPalettes[Math.floor(Math.random() * flowerPalettes.length)];
                        this.colors = palette;
                    }
                    this.height = this.isFlower ? 8 : 4;
                    this.baseGreen = 70 + Math.random() * 40;
                    this.phase = Math.random() * Math.PI * 2;
                }

                draw(time) {
                    const wind = Math.sin(time/1000 + this.x/200 + this.phase) * 3;
                    const heightFactor = (canvas.height - this.y) / canvas.height;
                    
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y);
                    ctx.lineTo(this.x + wind, this.y - this.height);
                    
                    if (this.isFlower) {
                        const colorIndex = Math.floor(time/500 + this.x/100 + this.y/100) % 3;
                        const nextIndex = (colorIndex + 1) % 3;
                        const mixFactor = (time/500 + this.x/100 + this.y/100) % 1;
                        ctx.strokeStyle = lerpColor(this.colors[colorIndex], this.colors[nextIndex], mixFactor);
                        ctx.lineWidth = 3;
                    } else {
                        const green = this.baseGreen + 
                                    Math.sin(time/1000 + this.x/100) * 10 +
                                    Math.sin(this.y/50) * 5;
                        const red = 45 + heightFactor * 10;
                        const blue = 39 + Math.sin(this.x/200) * 5;
                        ctx.strokeStyle = `rgb(${red},${green},${blue})`;
                        ctx.lineWidth = 1;
                    }
                    
                    ctx.stroke();
                }
            }

            function animate(timestamp) {
                ctx.fillStyle = '#2d5a27';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                grass.forEach(blade => blade.draw(timestamp));
                requestAnimationFrame(animate);
            }

            // Initialize
            setSize();
            window.addEventListener('resize', setSize);
            animate(0);
            
            console.log('Animation started');
        });
    </script>
</body>
</html>
